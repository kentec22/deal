<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deal or No Deal - Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            overflow: hidden;
            width: 100vw;
        }

        body.no-christmas {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        /* Header Section */
        .header {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            align-items: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 3px solid gold;
            margin-bottom: 10px;
            height: 12vh;
            min-height: 100px;
            position: relative;
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .logo {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid gold;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .game-title {
            text-align: center;
        }

        .game-title-img {
            max-width: 350px;
            max-height: 80px;
            object-fit: contain;
        }

        .theme-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        /* Audio Permission Button */
        .audio-permission {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1005;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: black;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .audio-permission:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        /* Player Info Section */
        .player-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
            height: 8vh;
            min-height: 60px;
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid gold;
            border-radius: 8px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .info-label {
            font-size: 0.8em;
            color: gold;
            margin-bottom: 3px;
        }

        .info-value {
            font-size: 1.1em;
            font-weight: bold;
        }

        /* Main Game Area */
        .game-area {
            display: grid;
            grid-template-columns: 70% 30%;
            gap: 10px;
            flex: 1;
            height: calc(75vh - 60px);
        }

        /* Cases Grid */
        .cases-container {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid gold;
            border-radius: 10px;
            padding: 15px;
            overflow: hidden;
            position: relative;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 12px;
            justify-items: center;
            align-items: center;
            height: 100%;
        }

        .case {
            width: 140px;
            height: 160px;
            background: url('suitcase.png') center/contain no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .case.selectable {
            cursor: pointer;
            animation: pulse 2s infinite;
        }

        .case.selected {
            transform: scale(1.05);
            border: 3px solid #ffd700;
            box-shadow: 0 0 20px gold;
        }

        .case.faded {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .case.highlighted {
            animation: caseHighlight 2s infinite;
            border: 2px solid #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .case.opened {
            background: url('suitcase-open.png') center/contain no-repeat;
        }

        .case-number {
            font-size: 1.8em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            margin-bottom: 5px;
        }

        .case-amount {
            font-size: 1.1em;
            font-weight: bold;
            color: gold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            display: none;
            text-align: center;
        }

        .case.opened .case-amount {
            display: block;
            animation: amountReveal 0.5s ease-out;
        }

        .case.opened .case-number {
            display: block;
            font-size: 0.9em;
            color: #ccc;
        }

        /* Amounts Grid */
        .amounts-container {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid gold;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            position: relative;
        }

        .amounts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            height: 100%;
        }

        .amount-item {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid gold;
            border-radius: 5px;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .amount-item.eliminated {
            background: rgba(255, 0, 0, 0.1);
            color: #888;
            opacity: 0.1;
            border-color: #666;
        }

        .amount-item.jackpot {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: 2px solid #4CAF50;
            animation: jackpotPulse 1.5s infinite;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .amount-item.jackpot.eliminated {
            background: rgba(76, 175, 80, 0.1);
            color: #888;
            opacity: 0.1;
            border-color: #666;
            animation: none;
            transform: scale(1);
            box-shadow: none;
        }

        .amount-value {
            font-size: 1.1em;
            font-weight: bold;
        }

        /* Footer */
        .footer {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 2px solid gold;
            margin-top: 10px;
            height: 5vh;
            min-height: 45px;
            position: relative;
        }

        .creator {
            color: gold;
            font-size: 0.8em;
        }

        .delay-timer {
            color: #FFD700;
            font-size: 0.9em;
            font-weight: bold;
            text-align: center;
        }

        .game-buttons {
            display: flex;
            gap: 8px;
            visibility: hidden;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: black;
        }

        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Splash Screens */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .splash-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            border: 5px solid gold;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 80%;
            position: relative;
            z-index: 2;
        }

        .company-logo-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            background: url('company.png') center/contain no-repeat;
            opacity: 0.4;
            z-index: 1;
            pointer-events: none;
        }

        .splash-title {
            font-size: 3em;
            color: gold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: relative;
            z-index: 2;
        }

        .splash-message {
            font-size: 1.5em;
            margin-bottom: 30px;
            color: white;
            position: relative;
            z-index: 2;
        }

        .splash-player {
            font-size: 2em;
            color: #FFD700;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: relative;
            z-index: 2;
        }

        .countdown-timer {
            font-size: 2em;
            color: #FFD700;
            margin: 20px 0;
            font-weight: bold;
            position: relative;
            z-index: 2;
        }

        .skip-button {
            margin-top: 20px;
            position: relative;
            z-index: 2;
        }

        /* Banker Offer Modal */
        .offer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .offer-content {
            background: linear-gradient(135deg, #2d1a6c, #1f1fb2);
            border: 5px solid silver;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 60%;
        }

        .offer-title {
            font-size: 2.5em;
            color: silver;
            margin-bottom: 20px;
        }

        .offer-amount {
            font-size: 4em;
            color: gold;
            margin: 30px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .offer-input {
            font-size: 2em;
            padding: 15px;
            width: 200px;
            text-align: center;
            border: 3px solid gold;
            border-radius: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            margin: 20px 0;
        }

        .offer-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Offer Display Splash */
        .offer-display {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1002;
        }

        .offer-display-content {
            background: linear-gradient(135deg, #2d1a6c, #1f1fb2);
            border: 5px solid gold;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 70%;
        }

        .banker-offer-amount {
            font-size: 5em;
            color: #FFD700;
            margin: 30px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            animation: offerPulse 2s infinite;
        }

        .decision-buttons {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-top: 40px;
        }

        .decision-btn {
            padding: 20px 40px;
            font-size: 1.8em;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .deal-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .no-deal-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .decision-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }

        /* Game End Splash */
        .game-end-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1003;
        }

        .game-end-content {
            background: linear-gradient(135deg, #1a6c2d, #1fb26c);
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            max-width: 80%;
        }

        .final-case {
            font-size: 4em;
            color: #FFD700;
            margin: 20px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
        }

        .final-amount {
            font-size: 6em;
            color: #4CAF50;
            margin: 30px 0;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.8);
            animation: finalReveal 2s ease-out;
        }

        .final-case-number {
            font-size: 2em;
            color: #FFD700;
            margin: 10px 0;
        }

        .auto-close-timer {
            font-size: 1.2em;
            color: #FFD700;
            margin: 20px 0;
            font-weight: bold;
        }

        /* Debug Panel */
        .debug-panel {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 350px;
            height: 200px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            overflow-y: auto;
            z-index: 1004;
            display: none;
        }

        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .debug-title {
            color: #00ff00;
            font-weight: bold;
        }

        .debug-close {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 10px;
        }

        .debug-close:hover {
            background: #ff6666;
        }

        /* Controls */
        .size-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .size-btn {
            padding: 4px 8px;
            font-size: 10px;
        }

        /* Christmas Theme Effects */
        .christmas-effect {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 999;
            animation: floatAround 6s linear infinite;
        }

        .christmas-border {
            position: relative;
            overflow: hidden;
        }

        .christmas-border::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #ff0000, #00ff00, #0000ff, #ff0000);
            background-size: 400% 400%;
            animation: christmasGradient 3s ease infinite;
            border-radius: 15px;
            z-index: -1;
            opacity: 0.7;
        }

        .christmas-border::after {
            content: 'üéÑüéÖüéÅ‚ùÑÔ∏è‚ú®';
            position: absolute;
            top: -15px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 24px;
            animation: christmasText 4s linear infinite;
            opacity: 0.8;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes caseHighlight {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            }
        }

        @keyframes caseOpen {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes amountReveal {
            0% { opacity: 0; transform: translateY(-10px) scale(0.8); }
            70% { opacity: 1; transform: translateY(0) scale(1.05); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes offerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes finalReveal {
            0% { opacity: 0; transform: scale(0.5) rotate(-10deg); }
            70% { opacity: 1; transform: scale(1.1) rotate(5deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }

        @keyframes jackpotPulse {
            0%, 100% { 
                transform: scale(1.05);
                box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 25px rgba(76, 175, 80, 0.8);
            }
        }

        @keyframes floatAround {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -20px) rotate(90deg); }
            50% { transform: translate(0, -40px) rotate(180deg); }
            75% { transform: translate(-20px, -20px) rotate(270deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }

        @keyframes christmasGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes christmasText {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .cases-grid {
                grid-template-columns: repeat(6, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            
            .case {
                width: 120px;
                height: 140px;
            }
        }

        @media (max-width: 1024px) {
            .game-area {
                grid-template-columns: 65% 35%;
            }
            
            .case {
                width: 110px;
                height: 130px;
            }
            
            .game-title-img {
                max-width: 300px;
            }

            .cases-grid {
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }

            .banker-offer-amount {
                font-size: 4em;
            }

            .final-amount {
                font-size: 5em;
            }
        }

        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 60% 40%;
            }
            
            .header {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                height: auto;
            }
            
            .case {
                width: 90px;
                height: 110px;
            }
            
            .game-title-img {
                max-width: 250px;
            }

            .cases-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }

            .banker-offer-amount {
                font-size: 3em;
            }

            .final-amount {
                font-size: 4em;
            }

            .decision-buttons {
                flex-direction: column;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .game-area {
                grid-template-columns: 1fr;
                grid-template-rows: 60% 40%;
            }
            
            .cases-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            
            .case {
                width: 80px;
                height: 100px;
            }
            
            .game-title-img {
                max-width: 200px;
            }

            .player-info {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: 1fr 1fr;
                height: 12vh;
            }

            .banker-offer-amount {
                font-size: 2.5em;
            }

            .final-amount {
                font-size: 3em;
            }

            .decision-btn {
                padding: 15px 30px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Permission Button -->
    <button class="audio-permission" id="audioPermissionBtn" onclick="enableAudio()">
        üîà ENABLE AUDIO
    </button>

    <div class="container">
        <!-- Header -->
        <div class="header" id="headerElement">
            <div class="logo-section">
                <div class="logo">
                    <img src="company.png" alt="Company Logo" class="company-logo" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\"color: gold; font-weight: bold;\">DEAL OR NO DEAL</div>';">
                </div>
            </div>
            <div class="game-title">
                <img src="dodTransparent.png" alt="DEAL OR NO DEAL" class="game-title-img" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\"color: gold; font-weight: bold; font-size: 2em;\">DEAL OR NO DEAL</div>';">
            </div>
            <div class="theme-controls">
                <label class="toggle-group">
                    <span>üéÑ Christmas</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="christmasToggle" checked>
                        <span class="slider"></span>
                    </label>
                </label>
                <div class="size-controls">
                    <button class="btn size-btn btn-info" onclick="adjustCaseSize(-5)">- Case</button>
                    <button class="btn size-btn btn-info" onclick="adjustCaseSize(5)">+ Case</button>
                </div>
            </div>
        </div>

        <!-- Player Info -->
        <div class="player-info">
            <div class="info-panel">
                <div class="info-label">PLAYER NAME</div>
                <div class="info-value" id="playerNameDisplay">-</div>
            </div>
            <div class="info-panel">
                <div class="info-label">YOUR CASE</div>
                <div class="info-value" id="playerCaseDisplay">-</div>
            </div>
            <div class="info-panel">
                <div class="info-label">BANKER'S OFFER</div>
                <div class="info-value" id="bankerOfferDisplay">‚Ç±0</div>
            </div>
            <div class="info-panel">
                <div class="info-label">AMOUNT OFFERED</div>
                <div class="info-value" id="amountOfferedDisplay">‚Ç±0</div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="game-area">
            <!-- Cases -->
            <div class="cases-container" id="casesContainer">
                <div class="cases-grid" id="casesGrid">
                    <!-- Cases will be generated dynamically -->
                </div>
            </div>

            <!-- Amounts -->
            <div class="amounts-container" id="amountsContainer">
                <div class="amounts-grid" id="amountsGrid">
                    <!-- Amounts will be generated dynamically -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer" id="footerElement">
            <div class="creator">created by kentec with chatgpt.</div>
            <div class="delay-timer" id="delayTimer">Next action in: --</div>
            <div class="game-buttons">
                <!-- Deal/No Deal buttons removed from here -->
            </div>
            <div class="control-buttons">
                <button class="btn btn-warning" onclick="restartGame()">RESTART</button>
                <button class="btn btn-info" onclick="toggleDebug()">DEBUG</button>
                <button class="btn btn-primary" onclick="openSettings()">SETTINGS</button>
            </div>
        </div>
    </div>

    <!-- Splash Screens -->
    <div class="splash-screen" id="welcomeSplash">
        <div class="company-logo-bg"></div>
        <div class="splash-content">
            <div class="splash-title">WELCOME TO</div>
            <img src="dodTransparent.png" alt="DEAL OR NO DEAL" style="max-width: 400px; margin: 20px 0;" onerror="this.style.display='none'; this.parentElement.innerHTML+='<div style=\"color: gold; font-size: 3em; margin: 20px 0;\">DEAL OR NO DEAL</div>';">
            <div class="splash-player" id="welcomePlayerName">Player</div>
            <div class="splash-message" style="font-size: 1.2em; color: gold; margin: 20px 0;">
                Get ready for an exciting game!
            </div>
            <button class="btn btn-primary btn-lg" onclick="startGame()" style="font-size: 1.5em; padding: 15px 30px;">
                START GAME
            </button>
        </div>
    </div>

    <div class="splash-screen" id="caseSelectSplash" style="display: none;">
        <div class="splash-content">
            <div class="splash-title">SELECT YOUR CASE</div>
            <div class="splash-message">The game will begin in:</div>
            <div class="countdown-timer" id="countdownTimer">10</div>
            <div class="splash-message" style="font-size: 1.2em; color: gold; margin-top: 20px;">
                Get ready to choose your case!
            </div>
            <button class="btn btn-warning skip-button" onclick="skipCaseSelection()">
                SKIP COUNTDOWN
            </button>
        </div>
    </div>

    <div class="splash-screen" id="levelSplash" style="display: none;">
        <div class="splash-content">
            <div class="splash-title" id="levelTitle">LEVEL 1</div>
            <div class="splash-message" id="levelMessage">Open 5 cases in this round</div>
            <button class="btn btn-primary btn-lg" onclick="hideLevelSplash()" style="font-size: 1.5em; padding: 15px 30px; margin-top: 20px;">
                CONTINUE
            </button>
        </div>
    </div>

    <!-- Banker Offer Modal -->
    <div class="offer-modal" id="bankerOfferModal">
        <div class="offer-content">
            <div class="offer-title">BANKER'S OFFER</div>
            <div class="splash-message">Enter the banker's offer amount:</div>
            <input type="number" class="offer-input" id="bankerOfferInput" placeholder="‚Ç±0" min="0">
            <div class="offer-buttons">
                <button class="btn btn-success btn-lg" onclick="submitOffer()" style="font-size: 1.5em;">
                    SUBMIT OFFER
                </button>
                <button class="btn btn-danger btn-lg" onclick="cancelOffer()" style="font-size: 1.5em;">
                    CANCEL
                </button>
            </div>
        </div>
    </div>

    <!-- Offer Display Splash -->
    <div class="offer-display" id="offerDisplaySplash">
        <div class="offer-display-content">
            <div class="splash-title">BANKER'S OFFER</div>
            <div class="splash-message">The banker is offering you:</div>
            <div class="banker-offer-amount" id="displayOfferAmount">‚Ç±0</div>
            <div class="splash-message">Will you take the deal?</div>
            <div class="decision-buttons">
                <button class="decision-btn deal-btn" onclick="handleDealDecision(true)">
                    DEAL
                </button>
                <button class="decision-btn no-deal-btn" onclick="handleDealDecision(false)">
                    NO DEAL
                </button>
            </div>
        </div>
    </div>

    <!-- Game End Splash -->
    <div class="game-end-splash" id="gameEndSplash">
        <div class="game-end-content">
            <div class="splash-title">GAME OVER</div>
            <div class="splash-message">Your final case contained:</div>
            <div class="final-case">Case #<span id="finalCaseNumber">0</span></div>
            <div class="final-amount" id="finalAmount">‚Ç±0</div>
            <div class="final-case-number" id="finalCaseDisplay">Case <span id="finalCaseNum">0</span></div>
            <div class="splash-message" id="endGameMessage">Thank you for playing!</div>
            <div class="auto-close-timer" id="autoCloseTimer">Auto-closing in 10 seconds...</div>
            <button class="btn btn-warning btn-lg" onclick="closeGameEndSplash()" style="font-size: 1.5em; padding: 15px 30px; margin-top: 20px;">
                CLOSE
            </button>
        </div>
    </div>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <div class="debug-header">
            <div class="debug-title">Debug Information</div>
            <button class="debug-close" onclick="toggleDebug()">CLOSE</button>
        </div>
        <div id="debugInfo">Game initialized...</div>
    </div>

    <script>
        // Game State
        const gameState = {
            playerName: '',
            playerCase: null,
            selectedCase: null,
            cases: [],
            amounts: [],
            remainingAmounts: [],
            openedCases: [],
            currentLevel: 1,
            casesToOpenThisLevel: 0,
            totalCases: 0,
            bankerOffer: 0,
            gamePhase: 'welcome',
            settings: null,
            audioController: null,
            caseSize: 140,
            visitorId: null,
            sessionId: null,
            audioEnabled: false,
            gameSettings: null
        };

        // Audio Controller Class (from settings)
        class AudioController {
            constructor() {
                this.currentAudio = null;
                this.audioTracks = new Map();
                this.enabledTracks = new Set();
                this.defaultFilesLoaded = new Set();
            }
            
            async loadDefaultTrack(name) {
                return new Promise((resolve) => {
                    const fileName = this.getAudioFileName(name);
                    if (!fileName) {
                        resolve(false);
                        return;
                    }
                    
                    const audio = new Audio(fileName);
                    audio.onloadeddata = () => {
                        this.audioTracks.set(name, audio);
                        this.defaultFilesLoaded.add(name);
                        resolve(true);
                    };
                    audio.onerror = () => {
                        debugLog(`Failed to load default audio: ${fileName}`);
                        resolve(false);
                    };
                    
                    setTimeout(() => {
                        if (!this.defaultFilesLoaded.has(name)) {
                            debugLog(`Timeout loading default audio: ${fileName}`);
                            resolve(false);
                        }
                    }, 3000);
                });
            }
            
            getAudioFileName(type) {
                const fileMap = {
                    intro: '1-intro.mp3',
                    selectCase: '2-case.mp3',
                    offer: '3-offer.mp3',
                    loop: '4-loop.mp3',
                    revealSmall: '5-smallcase.mp3',
                    revealBig: '6-bigcase.mp3',
                    win: '5-smallcase.mp3',
                    lose: '6-bigcase.mp3'
                };
                return fileMap[type];
            }
            
            play(trackName, loop = false) {
                this.stop();
                
                if (this.audioTracks.has(trackName) && this.enabledTracks.has(trackName)) {
                    this.currentAudio = this.audioTracks.get(trackName);
                    this.currentAudio.loop = loop;
                    this.currentAudio.currentTime = 0;
                    
                    const playPromise = this.currentAudio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(e => {
                            debugLog(`Play error for ${trackName}: ${e.message}`);
                        });
                    }
                    debugLog(`Playing: ${trackName} ${loop ? '(looping)' : ''}`);
                } else {
                    debugLog(`Cannot play: ${trackName} - ${!this.audioTracks.has(trackName) ? 'not loaded' : 'disabled'}`);
                }
            }
            
            stop() {
                if (this.currentAudio) {
                    this.currentAudio.pause();
                    this.currentAudio.currentTime = 0;
                    this.currentAudio = null;
                }
            }
            
            setEnabled(trackName, enabled) {
                if (enabled) {
                    this.enabledTracks.add(trackName);
                } else {
                    this.enabledTracks.delete(trackName);
                }
            }
        }

        // Global audio controller
        const audioController = new AudioController();

        // Tracking System
        const trackingSystem = {
            init: function() {
                this.generateVisitorId();
                this.generateSessionId();
                this.trackPageView();
                debugLog(`VISITOR_${gameState.visitorId}_SESSION_${gameState.sessionId}_PAGE_LOADED`, 'TRACKING');
            },
            
            generateVisitorId: function() {
                let visitorId = localStorage.getItem('dealOrNoDeal_visitorId');
                if (!visitorId) {
                    visitorId = 'VISITOR_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('dealOrNoDeal_visitorId', visitorId);
                }
                gameState.visitorId = visitorId;
            },
            
            generateSessionId: function() {
                gameState.sessionId = 'SESSION_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            },
            
            trackPageView: function() {
                const data = {
                    visitorId: gameState.visitorId,
                    sessionId: gameState.sessionId,
                    timestamp: new Date().toISOString(),
                    action: 'PAGE_VIEW',
                    userAgent: navigator.userAgent,
                    screenResolution: `${screen.width}x${screen.height}`,
                    language: navigator.language
                };
                this.logToAnalytics(data);
            },
            
            trackGameAction: function(action, details = {}) {
                const data = {
                    visitorId: gameState.visitorId,
                    sessionId: gameState.sessionId,
                    timestamp: new Date().toISOString(),
                    action: action,
                    details: details,
                    gamePhase: gameState.gamePhase,
                    currentLevel: gameState.currentLevel
                };
                this.logToAnalytics(data);
            },
            
            logToAnalytics: function(data) {
                const logEntry = `[${data.timestamp}] ${data.visitorId} - ${data.sessionId} - ${data.action} - ${JSON.stringify(data.details)}`;
                debugLog(logEntry, 'TRACKING');
            }
        };

        // Debug Logger
        const debugLogger = {
            log: function(message, level = 'INFO') {
                const timestamp = new Date().toISOString();
                const logMessage = `[${timestamp}] [${level}] ${message}`;
                
                const debugInfo = document.getElementById('debugInfo');
                if (debugInfo) {
                    debugInfo.innerHTML += logMessage + '<br>';
                    debugInfo.scrollTop = debugInfo.scrollHeight;
                }
                
                console.log(logMessage);
            },
            
            error: function(message) {
                this.log(message, 'ERROR');
            },
            
            warn: function(message) {
                this.log(message, 'WARN');
            }
        };

        // Shortcut for debug logging
        function debugLog(message, level = 'INFO') {
            debugLogger.log(message, level);
        }

        // Enable Audio Function
        function enableAudio() {
            gameState.audioEnabled = true;
            debugLog('Audio enabled by user interaction', 'AUDIO');
            
            const audioBtn = document.getElementById('audioPermissionBtn');
            if (audioBtn) {
                audioBtn.style.display = 'none';
            }
            
            // Play intro music if enabled
            if (gameState.gameSettings?.musicSettings?.intro?.enabled) {
                audioController.play('intro', true);
            }
        }

        // Load settings from localStorage
        function loadGameSettings() {
            const saved = localStorage.getItem('dealOrNoDealSettings');
            if (saved) {
                try {
                    gameState.gameSettings = JSON.parse(saved);
                    debugLog('Game settings loaded from storage');
                    
                    // Apply settings
                    if (gameState.gameSettings.playerName) {
                        gameState.playerName = gameState.gameSettings.playerName;
                        document.getElementById('playerNameDisplay').textContent = gameState.gameSettings.playerName;
                        document.getElementById('welcomePlayerName').textContent = gameState.gameSettings.playerName;
                    }
                    
                    // Apply music settings
                    if (gameState.gameSettings.musicSettings) {
                        Object.keys(gameState.gameSettings.musicSettings).forEach(track => {
                            const settings = gameState.gameSettings.musicSettings[track];
                            audioController.setEnabled(track, settings.enabled);
                        });
                    }
                    
                    // Apply Christmas theme
                    const christmasToggle = document.getElementById('christmasToggle');
                    if (christmasToggle) {
                        christmasToggle.checked = gameState.gameSettings.christmasTheme !== false;
                        initChristmasTheme();
                    }
                    
                } catch (error) {
                    debugLog('Error loading game settings: ' + error.message);
                    loadDefaultSettings();
                }
            } else {
                loadDefaultSettings();
            }
        }

        function loadDefaultSettings() {
            gameState.gameSettings = {
                playerName: 'Player',
                numCases: 20,
                smallAmounts: '100,200,300,400,500,750,1000,1500,2000,2500',
                bigAmounts: '5000,7500,10000,15000,20000,25000,50000,75000,100000,250000',
                christmasTheme: true,
                musicSettings: {
                    intro: { enabled: true, loop: true },
                    selectCase: { enabled: true, loop: false },
                    offer: { enabled: true, loop: false },
                    loop: { enabled: true, loop: true },
                    revealSmall: { enabled: true, loop: false },
                    revealBig: { enabled: true, loop: false },
                    win: { enabled: true, loop: false },
                    lose: { enabled: true, loop: false }
                }
            };
            debugLog('Loaded default settings');
        }

        // Christmas theme functions
        let snowInterval;

        function initChristmasTheme() {
            const isChristmas = document.getElementById('christmasToggle').checked;
            
            if (isChristmas) {
                document.body.classList.remove('no-christmas');
                startSnowfall();
            } else {
                document.body.classList.add('no-christmas');
                stopSnowfall();
            }
        }

        function startSnowfall() {
            stopSnowfall();
            snowInterval = setInterval(() => {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
                document.body.appendChild(snowflake);
                
                setTimeout(() => {
                    if (snowflake.parentNode) {
                        snowflake.parentNode.removeChild(snowflake);
                    }
                }, 5000);
            }, 100);
        }

        function stopSnowfall() {
            if (snowInterval) {
                clearInterval(snowInterval);
            }
            document.querySelectorAll('.snowflake').forEach(el => el.remove());
        }

        // Initialize the game
        async function initGame() {
            debugLog('Game initialization started');
            trackingSystem.init();
            
            // Show audio permission button initially
            const audioBtn = document.getElementById('audioPermissionBtn');
            if (audioBtn) {
                audioBtn.style.display = 'block';
            }
            
            // Load settings and initialize game state
            loadGameSettings();
            await initializeAudio();
            generateGameData();
            initializeGameUI();
            
            debugLog('Game initialization completed');
            
            // Add event listeners
            document.getElementById('christmasToggle').addEventListener('change', initChristmasTheme);
        }

        // Initialize audio system
        async function initializeAudio() {
            debugLog('Initializing audio system...');
            
            // Load all audio tracks
            const audioTracks = ['intro', 'selectCase', 'offer', 'loop', 'revealSmall', 'revealBig', 'win', 'lose'];
            
            for (const track of audioTracks) {
                const success = await audioController.loadDefaultTrack(track);
                if (success) {
                    debugLog(`‚úì Loaded audio: ${track}`);
                } else {
                    debugLog(`‚úó Failed to load: ${track}`);
                }
            }
            
            debugLog('Audio system initialized');
        }

        // Generate game data based on settings
        function generateGameData() {
            // Parse amounts from settings
            let smallAmounts = [100,200,300,400,500,750,1000,1500,2000,2500];
            let bigAmounts = [5000,7500,10000,15000,20000,25000,50000,75000,100000,250000];
            
            if (gameState.gameSettings.smallAmounts) {
                try {
                    smallAmounts = gameState.gameSettings.smallAmounts.split(',').map(amt => parseInt(amt.trim())).filter(amt => !isNaN(amt));
                } catch (e) {
                    debugLog('Error parsing small amounts, using defaults');
                }
            }
            
            if (gameState.gameSettings.bigAmounts) {
                try {
                    bigAmounts = gameState.gameSettings.bigAmounts.split(',').map(amt => parseInt(amt.trim())).filter(amt => !isNaN(amt));
                } catch (e) {
                    debugLog('Error parsing big amounts, using defaults');
                }
            }
            
            // Combine all amounts
            gameState.amounts = [...smallAmounts, ...bigAmounts];
            gameState.remainingAmounts = [...gameState.amounts];
            
            // Determine number of cases
            const numCases = Math.min(gameState.gameSettings.numCases || 20, gameState.amounts.length);
            gameState.totalCases = numCases;
            
            // Generate cases
            gameState.cases = [];
            for (let i = 1; i <= numCases; i++) {
                gameState.cases.push({
                    number: i,
                    amount: 0, // Will be assigned randomly
                    opened: false
                });
            }
            
            // Randomly assign amounts to cases
            const shuffledAmounts = [...gameState.amounts].sort(() => Math.random() - 0.5);
            gameState.cases.forEach((caseObj, index) => {
                caseObj.amount = shuffledAmounts[index];
            });
            
            debugLog(`Generated ${numCases} cases with ${gameState.amounts.length} amounts`);
        }

        // Initialize game UI
        function initializeGameUI() {
            generateCasesUI();
            generateAmountsUI();
            
            // Set level configuration from settings
            if (gameState.gameSettings.levels) {
                gameState.casesToOpenThisLevel = parseInt(gameState.gameSettings.levels[1]) || 5;
            } else {
                gameState.casesToOpenThisLevel = 5; // Default for level 1
            }
            
            debugLog('Game UI initialized');
        }

        // Generate cases UI
        function generateCasesUI() {
            const casesGrid = document.getElementById('casesGrid');
            if (!casesGrid) {
                debugLog('Cases grid element not found', 'ERROR');
                return;
            }
            
            casesGrid.innerHTML = '';
            
            for (let i = 1; i <= gameState.totalCases; i++) {
                const caseElement = document.createElement('div');
                caseElement.className = 'case selectable';
                caseElement.innerHTML = `
                    <div class="case-number">${i}</div>
                    <div class="case-amount"></div>
                `;
                caseElement.onclick = () => selectCase(caseElement, i);
                casesGrid.appendChild(caseElement);
            }
            
            // Adjust grid layout based on number of cases
            adjustCasesGridLayout();
            
            debugLog(`Generated ${gameState.totalCases} cases in UI`);
        }

        // Adjust grid layout based on case count
        function adjustCasesGridLayout() {
            const casesGrid = document.getElementById('casesGrid');
            if (!casesGrid) return;
            
            let cols, rows;
            
            if (gameState.totalCases <= 12) {
                cols = 4;
            } else if (gameState.totalCases <= 20) {
                cols = 5;
            } else {
                cols = 7;
            }
            
            rows = Math.ceil(gameState.totalCases / cols);
            
            casesGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            casesGrid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
        }

        // Generate amounts UI
        function generateAmountsUI() {
            const amountsGrid = document.getElementById('amountsGrid');
            if (!amountsGrid) {
                debugLog('Amounts grid element not found', 'ERROR');
                return;
            }
            
            amountsGrid.innerHTML = '';
            
            // Sort amounts for display
            const sortedAmounts = [...gameState.amounts].sort((a, b) => a - b);
            
            sortedAmounts.forEach((amount, index) => {
                const amountElement = document.createElement('div');
                amountElement.className = 'amount-item';
                amountElement.id = `amount-${amount}`;
                amountElement.innerHTML = `
                    <div class="amount-value">${formatAmount(amount)}</div>
                `;
                
                if (amount >= 100000) {
                    amountElement.classList.add('jackpot');
                }
                
                amountsGrid.appendChild(amountElement);
            });
            
            debugLog(`Generated ${sortedAmounts.length} amounts in UI`);
        }

        // Case selection function
        function selectCase(caseElement, caseNumber) {
            try {
                const caseObj = gameState.cases.find(c => c.number === caseNumber);
                if (!caseObj || caseObj.opened) return;
                
                // Play select case sound if enabled
                if (gameState.gameSettings?.musicSettings?.selectCase?.enabled) {
                    audioController.play('selectCase');
                }
                
                // Fade the selected case
                caseElement.classList.add('faded');
                caseElement.classList.remove('selectable');
                
                debugLog(`Case ${caseNumber} selected and faded`);
                trackingSystem.trackGameAction('CASE_SELECTED', { caseNumber: caseNumber });
                
                if (gameState.gamePhase === 'caseSelect') {
                    gameState.playerCase = caseObj;
                    document.getElementById('playerCaseDisplay').textContent = caseNumber;
                    hideCaseSelectSplash();
                    
                    // Play loop music if enabled
                    if (gameState.gameSettings?.musicSettings?.loop?.enabled) {
                        audioController.play('loop', true);
                    }
                } else if (gameState.gamePhase === 'playing') {
                    openCase(caseObj);
                }
            } catch (error) {
                debugLog(`Case selection error: ${error.message}`, 'ERROR');
            }
        }

        // Open case function
        function openCase(caseObj) {
            caseObj.opened = true;
            gameState.openedCases.push(caseObj);
            
            // Update case UI
            const caseElement = document.querySelector(`.case:nth-child(${caseObj.number})`);
            if (caseElement) {
                caseElement.classList.add('opened');
                caseElement.querySelector('.case-amount').textContent = formatAmount(caseObj.amount);
            }
            
            // Remove amount from available amounts
            const amountIndex = gameState.remainingAmounts.indexOf(caseObj.amount);
            if (amountIndex > -1) {
                gameState.remainingAmounts.splice(amountIndex, 1);
                
                // Update amounts UI
                const amountElement = document.getElementById(`amount-${caseObj.amount}`);
                if (amountElement) {
                    amountElement.classList.add('eliminated');
                }
            }
            
            // Play reveal sound based on amount size
            if (caseObj.amount >= 100000) {
                if (gameState.gameSettings?.musicSettings?.revealBig?.enabled) {
                    audioController.play('revealBig');
                }
            } else {
                if (gameState.gameSettings?.musicSettings?.revealSmall?.enabled) {
                    audioController.play('revealSmall');
                }
            }
            
            debugLog(`Case ${caseObj.number} opened with amount: ${formatAmount(caseObj.amount)}`);
            trackingSystem.trackGameAction('CASE_OPENED', { 
                caseNumber: caseObj.number,
                amount: caseObj.amount 
            });
            
            // Check if it's time for banker's offer
            checkBankerOffer();
        }

        // Check if it's time for banker's offer
        function checkBankerOffer() {
            const casesOpenedThisLevel = gameState.openedCases.length - 
                gameState.openedCases.filter(c => c.number === gameState.playerCase?.number).length;
            
            if (casesOpenedThisLevel >= gameState.casesToOpenThisLevel) {
                showBankerOffer();
            }
        }

        // Show banker's offer
        function showBankerOffer() {
            // Stop loop music
            audioController.stop();
            
            // Play offer music if enabled
            if (gameState.gameSettings?.musicSettings?.offer?.enabled) {
                audioController.play('offer');
            }
            
            // Calculate banker's offer (average of remaining amounts)
            const averageOffer = gameState.remainingAmounts.reduce((sum, amt) => sum + amt, 0) / gameState.remainingAmounts.length;
            gameState.bankerOffer = Math.round(averageOffer * 0.7); // 70% of average as offer
            
            document.getElementById('bankerOfferDisplay').textContent = formatAmount(gameState.bankerOffer);
            document.getElementById('displayOfferAmount').textContent = formatAmount(gameState.bankerOffer);
            
            // Show offer display
            document.getElementById('offerDisplaySplash').style.display = 'flex';
            gameState.gamePhase = 'offer';
            
            debugLog(`Banker's offer: ${formatAmount(gameState.bankerOffer)}`);
            trackingSystem.trackGameAction('BANKER_OFFER', { 
                offerAmount: gameState.bankerOffer,
                remainingAmounts: gameState.remainingAmounts.length 
            });
        }

        // Enhanced handleDealDecision function
        function handleDealDecision(acceptDeal) {
            debugLog(`Deal decision: ${acceptDeal ? 'DEAL' : 'NO DEAL'}`);
            trackingSystem.trackGameAction('DEAL_DECISION', { 
                accepted: acceptDeal, 
                bankerOffer: gameState.bankerOffer 
            });
            
            if (acceptDeal) {
                // Stop any playing audio
                audioController.stop();
                
                // Compare amounts and play appropriate audio
                const playerCaseAmount = gameState.playerCase ? gameState.playerCase.amount : 0;
                const isBigCase = playerCaseAmount > gameState.bankerOffer;
                
                debugLog(`Case comparison - Player case: ${playerCaseAmount}, Banker offer: ${gameState.bankerOffer}, Result: ${isBigCase ? 'BIG CASE' : 'SMALL CASE'}`);
                
                // Play comparison audio
                if (isBigCase) {
                    if (gameState.gameSettings?.musicSettings?.revealBig?.enabled) {
                        audioController.play('revealBig');
                    }
                    debugLog('Player took deal but their case was worth MORE than the offer', 'WARN');
                } else {
                    if (gameState.gameSettings?.musicSettings?.revealSmall?.enabled) {
                        audioController.play('revealSmall');
                    }
                    debugLog('Player took deal and their case was worth LESS than the offer');
                }
                
                endGame(acceptDeal);
            } else {
                hideOfferDisplay();
                continueGame();
            }
        }

        // Utility functions
        function formatAmount(amount) {
            return `‚Ç±${amount.toLocaleString()}`;
        }

        function startGame() {
            debugLog('Game started');
            trackingSystem.trackGameAction('GAME_STARTED');
            
            document.getElementById('welcomeSplash').style.display = 'none';
            document.getElementById('caseSelectSplash').style.display = 'flex';
            gameState.gamePhase = 'caseSelect';
            
            // Start case selection countdown
            startCaseSelectionCountdown();
        }

        function startCaseSelectionCountdown() {
            let countdown = 10;
            const timerElement = document.getElementById('countdownTimer');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                timerElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    skipCaseSelection();
                }
            }, 1000);
        }

        function skipCaseSelection() {
            debugLog('Case selection skipped');
            hideCaseSelectSplash();
        }

        function hideCaseSelectSplash() {
            document.getElementById('caseSelectSplash').style.display = 'none';
            gameState.gamePhase = 'playing';
            debugLog('Case selection splash hidden, game phase: playing');
        }

        function hideOfferDisplay() {
            document.getElementById('offerDisplaySplash').style.display = 'none';
            
            // Resume loop music
            if (gameState.gameSettings?.musicSettings?.loop?.enabled) {
                audioController.play('loop', true);
            }
            
            debugLog('Offer display hidden');
        }

        function continueGame() {
            gameState.currentLevel++;
            
            // Get cases to open for next level from settings
            if (gameState.gameSettings.levels && gameState.gameSettings.levels[gameState.currentLevel]) {
                gameState.casesToOpenThisLevel = parseInt(gameState.gameSettings.levels[gameState.currentLevel]);
            } else {
                gameState.casesToOpenThisLevel = 1; // Default for subsequent levels
            }
            
            // Show level splash
            document.getElementById('levelTitle').textContent = `LEVEL ${gameState.currentLevel}`;
            document.getElementById('levelMessage').textContent = `Open ${gameState.casesToOpenThisLevel} cases in this round`;
            document.getElementById('levelSplash').style.display = 'flex';
            
            debugLog(`Continuing to level ${gameState.currentLevel}, cases to open: ${gameState.casesToOpenThisLevel}`);
        }

        function hideLevelSplash() {
            document.getElementById('levelSplash').style.display = 'none';
            debugLog('Level splash hidden');
        }

        function endGame(acceptedDeal) {
            gameState.gamePhase = 'ended';
            
            // Reveal player's case
            const playerCaseAmount = gameState.playerCase ? gameState.playerCase.amount : 0;
            const finalAmount = acceptedDeal ? gameState.bankerOffer : playerCaseAmount;
            
            document.getElementById('finalCaseNumber').textContent = gameState.playerCase?.number || '0';
            document.getElementById('finalCaseNum').textContent = gameState.playerCase?.number || '0';
            document.getElementById('finalAmount').textContent = formatAmount(finalAmount);
            
            // Set end game message
            let message = 'Thank you for playing!';
            if (acceptedDeal) {
                message = playerCaseAmount > gameState.bankerOffer ? 
                    'You took the deal, but your case was worth more!' : 
                    'Great decision! You took the deal.';
            } else {
                message = `You won ${formatAmount(finalAmount)}!`;
            }
            document.getElementById('endGameMessage').textContent = message;
            
            // Play win/lose music
            if (acceptedDeal && playerCaseAmount > gameState.bankerOffer) {
                if (gameState.gameSettings?.musicSettings?.lose?.enabled) {
                    audioController.play('lose');
                }
            } else {
                if (gameState.gameSettings?.musicSettings?.win?.enabled) {
                    audioController.play('win');
                }
            }
            
            // Show game end splash
            document.getElementById('gameEndSplash').style.display = 'flex';
            
            // Start auto-close timer
            startAutoCloseTimer();
            
            debugLog(`Game ended - Deal accepted: ${acceptedDeal}, Final amount: ${formatAmount(finalAmount)}`);
            trackingSystem.trackGameAction('GAME_ENDED', { 
                acceptedDeal: acceptedDeal,
                finalOffer: gameState.bankerOffer,
                caseAmount: playerCaseAmount,
                finalAmount: finalAmount
            });
        }

        function startAutoCloseTimer() {
            let countdown = 10;
            const timerElement = document.getElementById('autoCloseTimer');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                timerElement.textContent = `Auto-closing in ${countdown} seconds...`;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    closeGameEndSplash();
                }
            }, 1000);
        }

        function closeGameEndSplash() {
            document.getElementById('gameEndSplash').style.display = 'none';
            audioController.stop();
            debugLog('Game end splash closed');
        }

        // Banker offer modal functions (for manual banker input)
        function submitOffer() {
            const offerInput = document.getElementById('bankerOfferInput');
            const offerAmount = parseInt(offerInput.value);
            
            if (!isNaN(offerAmount) && offerAmount > 0) {
                gameState.bankerOffer = offerAmount;
                document.getElementById('bankerOfferDisplay').textContent = formatAmount(offerAmount);
                document.getElementById('displayOfferAmount').textContent = formatAmount(offerAmount);
                document.getElementById('bankerOfferModal').style.display = 'none';
                debugLog(`Manual banker offer set: ${formatAmount(offerAmount)}`);
            }
        }

        function cancelOffer() {
            document.getElementById('bankerOfferModal').style.display = 'none';
        }

        // Control functions
        function restartGame() {
            debugLog('Game restarted');
            trackingSystem.trackGameAction('GAME_RESTARTED');
            location.reload();
        }

        function toggleDebug() {
            const debugPanel = document.getElementById('debugPanel');
            if (debugPanel) {
                debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                debugLog('Debug panel toggled');
            }
        }

        function openSettings() {
            debugLog('Opening settings page');
            window.open('settings.html', '_blank');
        }

        function adjustCaseSize(change) {
            gameState.caseSize += change;
            const cases = document.querySelectorAll('.case');
            cases.forEach(caseElement => {
                caseElement.style.width = gameState.caseSize + 'px';
                caseElement.style.height = (gameState.caseSize + 20) + 'px';
            });
            debugLog(`Case size adjusted: ${change}, new size: ${gameState.caseSize}`);
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            initGame();
            debugLog('Page fully loaded');
            
            // Add click listeners for audio enablement
            document.addEventListener('click', function() {
                if (!gameState.audioEnabled) {
                    enableAudio();
                }
            });
        });
    </script>
</body>
</html>
