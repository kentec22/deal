<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deal or No Deal - 15 Case PH Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --stage-width: 1920;
      --stage-height: 1080;
      --case-size: 150px;
      --case-border-radius: 12px;
      --primary-gold: #ffcc00;
      --primary-gold-soft: rgba(255, 204, 0, 0.4);
      --accent-blue: #1e88e5;
      --accent-red: #ef5350;
      --text-main: #f5f5f5;
      --text-muted: #aaaaaa;
      --bg-gradient: radial-gradient(circle at top, #222 0%, #050505 55%, #000 100%);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000;
      color: var(--text-main);
      font-family: system-ui, sans-serif;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    /* ---------- FULLSCREEN NAME PROMPT ---------- */

    #namePromptOverlay {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      text-align: center;
      padding: 20px;
    }

    #namePromptOverlay h1 {
      font-size: 32px;
      margin-bottom: 20px;
    }

    #playerNameInput {
      padding: 12px 16px;
      font-size: 18px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #111;
      color: #fff;
      width: 260px;
      text-align: center;
      margin-bottom: 20px;
    }

    #startGameBtn {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #1e88e5;
      color: #fff;
      cursor: pointer;
    }

    #startGameBtn:hover {
      background: #1565c0;
    }

    /* ---------- GAME VIEWPORT ---------- */

    .viewport {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .stage-wrapper {
      width: var(--stage-width)px;
      height: var(--stage-height)px;
      background: var(--bg-gradient);
      transform-origin: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 40px rgba(0,0,0,0.8);
    }

    /* ---------- HEADER ---------- */

    .game-root {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      padding: 20px 30px;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title-main {
      font-size: 32px;
      color: var(--primary-gold);
      letter-spacing: 0.2em;
    }

    .player-name-tag {
      padding: 6px 12px;
      background: rgba(0,0,0,0.6);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .status-chip {
      padding: 6px 12px;
      background: rgba(0,0,0,0.6);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      color: var(--primary-gold);
      font-weight: bold;
    }

    .btn {
      padding: 6px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #444;
      color: #fff;
    }

    /* ---------- CASE GRID ---------- */

    .game-body {
      flex: 1;
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 16px;
      margin-top: 10px;
    }

    .case-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
    }

    .case {
      width: var(--case-size);
      aspect-ratio: 4/3;
      background: #333;
      border-radius: var(--case-border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .case img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .case-number {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      padding: 3px 10px;
      border-radius: 999px;
      color: var(--primary-gold);
      font-weight: bold;
    }

    .case.revealed img {
      filter: grayscale(1) brightness(0.5);
    }

    /* ---------- MAIN CASE PANEL ---------- */

    .main-case-panel {
      background: rgba(0,0,0,0.6);
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      gap: 12px;
    }

    .main-case-slot {
      width: 180px;
      height: 130px;
      border: 2px dashed rgba(255,255,255,0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .main-case-placeholder {
      color: var(--text-muted);
      font-size: 13px;
      text-align: center;
    }

    /* ---------- VALUES PANEL ---------- */

    .values-panel {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      max-height: 220px;
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(2,1fr);
      gap: 6px;
    }

    .value-item {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      display: flex;
      justify-content: space-between;
    }

    .value-item.opened {
      opacity: 0.3;
      text-decoration: line-through;
    }

    /* ---------- BANKER PANEL ---------- */

    .banker-panel {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .banker-offer-value {
      font-size: 20px;
      color: var(--primary-gold);
      font-weight: bold;
    }

    .game-log {
      max-height: 150px;
      overflow-y: auto;
      font-size: 12px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>

<!-- ✅ FULLSCREEN NAME PROMPT -->
<div id="namePromptOverlay">
  <h1>Enter your name</h1>
  <input id="playerNameInput" type="text" placeholder="Leave blank if none" />
  <button id="startGameBtn">Start</button>
</div>

<div class="viewport">
  <div class="stage-wrapper" id="stageWrapper">

    <div class="game-root" id="gameRoot" style="display:none;">
      <header class="game-header">
        <div class="title-main">DEAL OR NO DEAL</div>
        <div class="header-right">
          <span class="player-name-tag" id="playerNameTag">Player:</span>
          <span class="status-chip" id="statusChip">Choose Your Case</span>
          <button class="btn" id="openSettingsBtn">Settings</button>
        </div>
      </header>

      <main class="game-body">
        <section>
          <div class="case-grid" id="caseGrid"></div>
        </section>

        <section>
          <div class="main-case-panel">
            <div class="main-case-slot" id="mainCaseSlot">
              <div class="main-case-placeholder">No case selected</div>
            </div>
            <div>
              <div>Your Case</div>
              <div id="mainCaseNumberDisplay" style="font-size:20px;color:var(--primary-gold);">#—</div>
            </div>
          </div>

          <div class="values-panel" id="valuesPanel"></div>

          <div class="banker-panel">
            <div>Banker Offer:</div>
            <div class="banker-offer-value" id="bankerOfferValue">Waiting...</div>
            <button class="btn" id="openNextBtn">Open next case</button>
            <button class="btn" id="callBankerBtn">Call banker</button>
            <button class="btn" id="resetGameBtn">Reset</button>
            <div class="game-log" id="gameLog"></div>
          </div>
        </section>
      </main>

    </div>
  </div>
</div>

  <script>
/* ---------- SAFE AUTOPLAY MUSIC ---------- */
const bgMusic = new Audio("2/1-intro.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.6;

window.addEventListener("load", () => {
  bgMusic.play().catch(() => {
    const resume = () => {
      bgMusic.play().catch(()=>{});
      window.removeEventListener("click", resume);
      window.removeEventListener("keydown", resume);
      window.removeEventListener("touchstart", resume);
    };
    window.addEventListener("click", resume);
    window.addEventListener("keydown", resume);
    window.addEventListener("touchstart", resume);
  });
});

/* ---------- STAGE SCALING ---------- */
const stageWrapper = document.getElementById("stageWrapper");
function updateScale() {
  const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
  stageWrapper.style.transform = "scale(" + scale + ")";
}
window.addEventListener("resize", updateScale);
updateScale();

/* ---------- GAME STATE ---------- */
const DEFAULT_AMOUNTS = [
  0,10,100,250,500,750,1000,1500,2000,2500,3000,4000,5000,7000,10000
];

let amounts = DEFAULT_AMOUNTS.slice();
let shuffled = [];
let caseMap = {};
let opened = new Set();
let mainCase = null;
let round = 0;
let openedThisRound = 0;
const ROUND_SCHEDULE = [5,4,3,2,1];

const caseGrid = document.getElementById("caseGrid");
const valuesPanel = document.getElementById("valuesPanel");
const mainCaseSlot = document.getElementById("mainCaseSlot");
const mainCaseNumberDisplay = document.getElementById("mainCaseNumberDisplay");
const bankerOfferValue = document.getElementById("bankerOfferValue");
const gameLog = document.getElementById("gameLog");
const statusChip = document.getElementById("statusChip");

/* ---------- NAME PROMPT ---------- */
const namePromptOverlay = document.getElementById("namePromptOverlay");
const playerNameInput = document.getElementById("playerNameInput");
const startGameBtn = document.getElementById("startGameBtn");
const gameRoot = document.getElementById("gameRoot");
const playerNameTag = document.getElementById("playerNameTag");

startGameBtn.addEventListener("click", () => {
  const name = playerNameInput.value.trim();
  playerNameTag.textContent = "Player: " + name;
  namePromptOverlay.style.display = "none";
  gameRoot.style.display = "flex";
  initGame();
});

/* ---------- UTIL ---------- */
function log(msg) {
  const div = document.createElement("div");
  div.textContent = msg;
  gameLog.appendChild(div);
  gameLog.scrollTop = gameLog.scrollHeight;
}

function formatPHP(n) {
  return "₱" + n.toLocaleString("en-PH");
}

/* ---------- BUILD VALUES PANEL ---------- */
function buildValues() {
  valuesPanel.innerHTML = "";
  const sorted = [...amounts].sort((a,b)=>a-b);
  sorted.forEach(v=>{
    const item = document.createElement("div");
    item.className = "value-item";
    item.dataset.amount = v;
    item.textContent = formatPHP(v);
    valuesPanel.appendChild(item);
  });
}

function markValue(v) {
  valuesPanel.querySelectorAll(".value-item").forEach(el=>{
    if(Number(el.dataset.amount)===v) el.classList.add("opened");
  });
}

/* ---------- CASE GRID ---------- */
function createCase(i) {
  const div = document.createElement("div");
  div.className = "case";
  div.dataset.index = i;

  const img = document.createElement("img");
  img.src = "suitcase.png";

  const num = document.createElement("div");
  num.className = "case-number";
  num.textContent = i;

  div.appendChild(img);
  div.appendChild(num);

  div.addEventListener("click", ()=>onCaseClick(i,div));
  return div;
}

function buildGrid() {
  caseGrid.innerHTML = "";
  for(let i=1;i<=15;i++){
    if(i===mainCase) continue;
    caseGrid.appendChild(createCase(i));
  }
}

/* ---------- MAIN CASE ---------- */
function setMainCase(i) {
  mainCase = i;
  mainCaseSlot.innerHTML = "";
  const c = createCase(i);
  c.classList.add("disabled");
  mainCaseSlot.appendChild(c);
  mainCaseNumberDisplay.textContent = "#" + i;
}

/* ---------- GAME LOGIC ---------- */
function revealCase(i, el) {
  if(opened.has(i) || i===mainCase) return;
  opened.add(i);

  const amount = caseMap[i];
  markValue(amount);

  el.classList.add("revealed");
  el.querySelector("img").src = "suitcase-open.png";

  log("Opened case #" + i + ": " + formatPHP(amount));

  openedThisRound++;
  const need = ROUND_SCHEDULE[round];
  if(openedThisRound >= need) {
    statusChip.textContent = "Call the banker";
  }
}

function onCaseClick(i, el) {
  if(mainCase===null) {
    setMainCase(i);
    buildGrid();
    statusChip.textContent = "Open " + ROUND_SCHEDULE[0] + " cases";
    return;
  }

  const need = ROUND_SCHEDULE[round];
  if(openedThisRound >= need) {
    statusChip.textContent = "Call the banker";
    return;
  }

  revealCase(i, el);
}

/* ---------- BANKER ---------- */
document.getElementById("callBankerBtn").addEventListener("click", ()=>{
  const remaining = amounts.filter(a=>!opened.has(a));
  const avg = remaining.reduce((a,b)=>a+b,0)/remaining.length;
  bankerOfferValue.textContent = formatPHP(Math.round(avg));
  log("Banker offers: " + formatPHP(Math.round(avg)));

  openedThisRound = 0;
  if(round < ROUND_SCHEDULE.length-1) round++;
  statusChip.textContent = "Open " + ROUND_SCHEDULE[round] + " cases";
});

document.getElementById("openNextBtn").addEventListener("click", ()=>{
  const need = ROUND_SCHEDULE[round];
  const left = need - openedThisRound;
  statusChip.textContent = "Open " + left + " more";
});

/* ---------- RESET ---------- */
document.getElementById("resetGameBtn").addEventListener("click", initGame);

/* ---------- INIT GAME ---------- */
function initGame() {
  opened.clear();
  mainCase = null;
  round = 0;
  openedThisRound = 0;

  shuffled = [...amounts].sort(()=>Math.random()-0.5);
  caseMap = {};
  for(let i=0;i<15;i++) caseMap[i+1] = shuffled[i];

  mainCaseSlot.innerHTML = '<div class="main-case-placeholder">No case selected</div>';
  mainCaseNumberDisplay.textContent = "#—";

  </body>
    </html>
